\begin{algorithm}[H]
    \caption{\label{alg.nipopow-velvet-upchain}Supplying the necessary data
    to calculate a connected $\chain\upchain^\mu$ during a velvet fork.}
    \begin{algorithmic}[1]
        \Function{{\sf find} $\chain\upchain^\mu$}{$b$, realLink, blockById}
            \Let{B}{\chain[-1]}
            \Let{\textsf{aux}}{\{B\}}
            \Let{\pi}{[~]}
            \If{$\emph{level}(B) \geq \mu$}
                \Let{\pi}{\pi B}
            \EndIf
            \While{$B \neq b$}
                \State $(B, \textsf{aux'})$
                \begin{varwidth}[t]{\linewidth}
                    $\gets$
                    \textsf{followUp}$(B, \mu,
                    \textsf{realLink}, \textsf{blockById})$
                \end{varwidth}
                \Let{\textsf{aux}}{\textsf{aux} \cup \textsf{aux'}}
                \Let{\pi}{\pi B}
            \EndWhile
            \State\Return{$\pi$, aux}
        \EndFunction
    \vskip2pt
    \end{algorithmic}
\end{algorithm}
